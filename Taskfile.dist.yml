# https://taskfile.dev

version: '3'

includes:
  nextjs:
    taskfile: ./nextjs/Taskfile.dist.yml
    dir: ./nextjs  # tasks from this Taskfile should run in this directory
  server:
    taskfile: ./server/Taskfile.dist.yml
    dir: ./server  # tasks from this Taskfile should run in this directory
  types:
    taskfile: ./types/Taskfile.dist.yml
    dir: ./types  # tasks from this Taskfile should run in this directory
  util:
    taskfile: ./Taskfile.util.yml
    internal: true

tasks:
  default:
    desc: List available tasks.
    aliases: [ls, list]
    silent: true
    cmds:
      - task: util:list

  ########################## ðŸš€ DEV SETUP ðŸš€ #########################
  ########## ðŸš€ Commands for first-time developer setup. ðŸš€ ##########

  initial-dev-setup:
    desc: Everything you need to set up your dev environment.
    aliases: [setup, setup-all, dev-setup, initial-setup]
    deps: [install]
    cmds:
      - bash bin/dev-setup.bash

  ######################## ðŸ”§ DEV COMMANDS ðŸ”§ ########################
  ################# ðŸ”§ Commands you'll use OFTEN. ðŸ”§ #################

  install:
    desc: Install all project dependencies.
    aliases: [i, install-all]
    sources:
      - ./package*.json
      - ./{nextjs,server,types}/package*.json
    generates:
      - ./node_modules/**/*
      - ./{nextjs,server,types}/node_modules/**/*
    deps: [util:trove-configure-codeartifact]
    cmds:
      # Ignore confusing pre/post install scripts in package.json
      - npm install --ignore-scripts
      - task: nextjs:install
      - task: server:install
      - task: types:install
      - npx tsx setupVSCodeSettings.ts

  dev:
    desc: Run all dev watch commands.
    summary: |
      Run all dev watch commands.  Interleaves output from each command.
    aliases: [w, watch, watch-all, dev-all]
    deps: [nextjs:dev, server:dev, nextjs:storybook]

  ######################### ðŸ”§ custom tasks ðŸ”§ ########################

  # Add any custom DEV COMMANDS tasks here.


  ########################### ðŸ§¹ LINTING ðŸ§¹ ###########################
  ######## ðŸ§¹ Commands for checking and cleaning the code. ðŸ§¹ #########

  check-all:
    desc: Check all code.
    summary: |
      Run all linting and type checking commands.  Interleaves output from each
      command.
    aliases: [c, check]
    # Runs all checks in parallel.
    deps: [nextjs:check, server:check, types:gen-all]

  ######################### ðŸ§¹ custom tasks ðŸ§¹ ########################

  # Add any custom LINTING tasks here.
